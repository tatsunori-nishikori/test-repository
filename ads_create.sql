CREATE DATABASE IF NOT EXISTS spike_ads charset=utf8;
GRANT ALL PRIVILEGES ON spike_ads.* TO spike@'%' IDENTIFIED BY 'Gd2gSMqZp' WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON spike_ads.* TO spike@localhost IDENTIFIED BY 'Gd2gSMqZp' WITH GRANT OPTION;

use spike_ads;
set names 'utf8';

--
--  広告出稿テーブル
--
CREATE TABLE IF NOT EXISTS ads (
  serial_number BIGINT UNSIGNED AUTO_INCREMENT,
  ad_id VARCHAR(8)  NOT NULL UNIQUE
  goods_id  VARCHAR(16) NOT NULL,
  ad_url  VARHCAR(255) NOT NULL COMMENT 'リダイレクト先のURL',
  owner_id  VARCHAR(16) NOT NULL COMMENT '広告主 enduser_id',
  rate  SMALLINT UNSIGNED NOT NULL DEFAULT 0 '決済額に対する広告報酬の料率千分率',
  price DOUBLE UNSIGNED NOT NULL COMMENT '出稿時点での決済リンクの金額',
  rate_claim  SMALLINT UNSIGNED NOT NULL DEFAULT 10 COMMENT '決済額に対する広告料請求の料率千分率',
  rate_reward SMALLINT UNSIGNED NOT NULL DEFAULT 5  COMMENT '決済額に対する広告報酬支払の料率千分率',
  reward  DOUBLE UNSIGNED NOT NULL  COMMENT '(決済リンク金額) × (報酬支払い料率) × 1/1000',
  link_count  INTEGER UNSIGNED  NULL DEFAULT 0 COMMENT '紹介リンクが発行された数',
  expire_date DATETIME  NOT NULL,
  status_flag SMALLINT UNSIGNED NOT NULL COMMENT '100:出稿中 255:削除',
  http_referrer TEXT NOT NULL,
  user_agent  VARCHAR(512) NOT NULL,
  remoto_host VARCHAR(255)  NOT NULL,
  remoto_address  VARCHAR(255)  NOT NULL,
  language  VARCHAR(8) NOT NULL,
  country_code VARCHAR(8) NOT NULL,
  region_code VARCHAR(8) NOT NULL,
  registered_at DATETIME NULL,
	updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB character set utf8 PARTITION BY RANGE (TO_DAYS(registered_at))(
PARTITION epep201301 VALUES LESS THAN (TO_DAYS('2013-01-01')) ENGINE = InnoDB,
PARTITION epep201302 VALUES LESS THAN (TO_DAYS('2013-02-01')) ENGINE = InnoDB,
PARTITION epep201303 VALUES LESS THAN (TO_DAYS('2013-03-01')) ENGINE = InnoDB,
PARTITION epep201304 VALUES LESS THAN (TO_DAYS('2013-04-01')) ENGINE = InnoDB,
PARTITION epep201305 VALUES LESS THAN (TO_DAYS('2013-05-01')) ENGINE = InnoDB,
PARTITION epep201306 VALUES LESS THAN (TO_DAYS('2013-06-01')) ENGINE = InnoDB,
PARTITION epep201307 VALUES LESS THAN (TO_DAYS('2013-07-01')) ENGINE = InnoDB,
PARTITION epep201308 VALUES LESS THAN (TO_DAYS('2013-08-01')) ENGINE = InnoDB,
PARTITION epep201309 VALUES LESS THAN (TO_DAYS('2013-09-01')) ENGINE = InnoDB,
PARTITION epep201310 VALUES LESS THAN (TO_DAYS('2013-10-01')) ENGINE = InnoDB,
PARTITION epep201311 VALUES LESS THAN (TO_DAYS('2013-11-01')) ENGINE = InnoDB,
PARTITION epep201312 VALUES LESS THAN (TO_DAYS('2013-12-01')) ENGINE = InnoDB,
PARTITION epep201401 VALUES LESS THAN (TO_DAYS('2014-01-01')) ENGINE = InnoDB,
PARTITION epep201402 VALUES LESS THAN (TO_DAYS('2014-02-01')) ENGINE = InnoDB,
PARTITION epep201403 VALUES LESS THAN (TO_DAYS('2014-03-01')) ENGINE = InnoDB,
PARTITION epep201404 VALUES LESS THAN (TO_DAYS('2014-04-01')) ENGINE = InnoDB,
PARTITION epep201405 VALUES LESS THAN (TO_DAYS('2014-05-01')) ENGINE = InnoDB,
PARTITION epep201406 VALUES LESS THAN (TO_DAYS('2014-06-01')) ENGINE = InnoDB,
PARTITION epep201407 VALUES LESS THAN (TO_DAYS('2014-07-01')) ENGINE = InnoDB,
PARTITION epep201408 VALUES LESS THAN (TO_DAYS('2014-08-01')) ENGINE = InnoDB,
PARTITION epep201409 VALUES LESS THAN (TO_DAYS('2014-09-01')) ENGINE = InnoDB,
PARTITION epep201410 VALUES LESS THAN (TO_DAYS('2014-10-01')) ENGINE = InnoDB,
PARTITION epep201411 VALUES LESS THAN (TO_DAYS('2014-11-01')) ENGINE = InnoDB,
PARTITION epep201412 VALUES LESS THAN (TO_DAYS('2014-12-01')) ENGINE = InnoDB,
PARTITION epep201501 VALUES LESS THAN (TO_DAYS('2015-01-01')) ENGINE = InnoDB,
PARTITION epep201502 VALUES LESS THAN (TO_DAYS('2015-02-01')) ENGINE = InnoDB,
PARTITION epep201503 VALUES LESS THAN (TO_DAYS('2015-03-01')) ENGINE = InnoDB,
PARTITION epep201504 VALUES LESS THAN (TO_DAYS('2015-04-01')) ENGINE = InnoDB,
PARTITION epep201505 VALUES LESS THAN (TO_DAYS('2015-05-01')) ENGINE = InnoDB,
PARTITION epep201506 VALUES LESS THAN (TO_DAYS('2015-06-01')) ENGINE = InnoDB,
PARTITION epep201507 VALUES LESS THAN (TO_DAYS('2015-07-01')) ENGINE = InnoDB,
PARTITION epep201508 VALUES LESS THAN (TO_DAYS('2015-08-01')) ENGINE = InnoDB,
PARTITION epep201509 VALUES LESS THAN (TO_DAYS('2015-09-01')) ENGINE = InnoDB,
PARTITION epep201510 VALUES LESS THAN (TO_DAYS('2015-10-01')) ENGINE = InnoDB,
PARTITION epep201511 VALUES LESS THAN (TO_DAYS('2015-11-01')) ENGINE = InnoDB,
PARTITION epep201512 VALUES LESS THAN (TO_DAYS('2015-12-01')) ENGINE = InnoDB,
PARTITION epep201601 VALUES LESS THAN (TO_DAYS('2016-01-01')) ENGINE = InnoDB,
PARTITION epep201602 VALUES LESS THAN (TO_DAYS('2016-02-01')) ENGINE = InnoDB,
PARTITION epep201603 VALUES LESS THAN (TO_DAYS('2016-03-01')) ENGINE = InnoDB,
PARTITION epep201604 VALUES LESS THAN (TO_DAYS('2016-04-01')) ENGINE = InnoDB,
PARTITION epep201605 VALUES LESS THAN (TO_DAYS('2016-05-01')) ENGINE = InnoDB,
PARTITION epep201606 VALUES LESS THAN (TO_DAYS('2016-06-01')) ENGINE = InnoDB,
PARTITION epep201607 VALUES LESS THAN (TO_DAYS('2016-07-01')) ENGINE = InnoDB,
PARTITION epep201608 VALUES LESS THAN (TO_DAYS('2016-08-01')) ENGINE = InnoDB,
PARTITION epep201609 VALUES LESS THAN (TO_DAYS('2016-09-01')) ENGINE = InnoDB,
PARTITION epep201610 VALUES LESS THAN (TO_DAYS('2016-10-01')) ENGINE = InnoDB,
PARTITION epep201611 VALUES LESS THAN (TO_DAYS('2016-11-01')) ENGINE = InnoDB,
PARTITION epep201612 VALUES LESS THAN (TO_DAYS('2016-12-01')) ENGINE = InnoDB,
PARTITION epep201701 VALUES LESS THAN (TO_DAYS('2017-01-01')) ENGINE = InnoDB,
PARTITION epep201702 VALUES LESS THAN (TO_DAYS('2017-02-01')) ENGINE = InnoDB,
PARTITION epep201703 VALUES LESS THAN (TO_DAYS('2017-03-01')) ENGINE = InnoDB,
PARTITION epep201704 VALUES LESS THAN (TO_DAYS('2017-04-01')) ENGINE = InnoDB,
PARTITION epep201705 VALUES LESS THAN (TO_DAYS('2017-05-01')) ENGINE = InnoDB,
PARTITION epep201706 VALUES LESS THAN (TO_DAYS('2017-06-01')) ENGINE = InnoDB,
PARTITION epep201707 VALUES LESS THAN (TO_DAYS('2017-07-01')) ENGINE = InnoDB,
PARTITION epep201708 VALUES LESS THAN (TO_DAYS('2017-08-01')) ENGINE = InnoDB,
PARTITION epep201709 VALUES LESS THAN (TO_DAYS('2017-09-01')) ENGINE = InnoDB,
PARTITION epep201710 VALUES LESS THAN (TO_DAYS('2017-10-01')) ENGINE = InnoDB,
PARTITION epep201711 VALUES LESS THAN (TO_DAYS('2017-11-01')) ENGINE = InnoDB,
PARTITION epep201712 VALUES LESS THAN (TO_DAYS('2017-12-01')) ENGINE = InnoDB,
PARTITION pmax VALUES LESS THAN MAXVALUE ENGINE = InnoDB
);

CREATE INDEX idx_ads_registered_at ON ads(registered_at);

--
-- 広告出稿　紹介リンクテーブル
--
CREATE TABLE IF NOT EXISTS ad_links (
  serial_number BIGINT UNSIGNED AUTO_INCREMENT,
  link_id VARCHAR(8)  NOT NULL UNIQUE,
  ad_id VARCHAR(8)  NOT NULL  COMMENT 'adテーブルのad_id',
  affiliator_id VARCHAR(16) NOT NULL  COMMENT '紹介リンクを生成した（報酬を受け取る）enduserのuser_id',
  expire_date DATETIME  NOT NULL,
  http_referrer TEXT  NOT NULL,
  user_agent  VARCHAR(512) NOT NULL,
  remoto_host VARCHAR(255)  NOT NULL,
  remoto_address  VARCHAR(255)  NOT NULL,
  language  VARCHAR(8)  NOT NULL,
  country_code  VARCHAR(8)  NOT NULL  COMMENT 'GeoIP関数で取得可能な国コード',
  region_code VARCHAR(8)  NOT NULL  COMMENT 'GeoIP関数で取得可能な地域コード',
  registered_at DATETIME NULL,
	updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB character set utf8 PARTITION BY RANGE (TO_DAYS(registered_at))(
PARTITION epep201301 VALUES LESS THAN (TO_DAYS('2013-01-01')) ENGINE = InnoDB,
PARTITION epep201302 VALUES LESS THAN (TO_DAYS('2013-02-01')) ENGINE = InnoDB,
PARTITION epep201303 VALUES LESS THAN (TO_DAYS('2013-03-01')) ENGINE = InnoDB,
PARTITION epep201304 VALUES LESS THAN (TO_DAYS('2013-04-01')) ENGINE = InnoDB,
PARTITION epep201305 VALUES LESS THAN (TO_DAYS('2013-05-01')) ENGINE = InnoDB,
PARTITION epep201306 VALUES LESS THAN (TO_DAYS('2013-06-01')) ENGINE = InnoDB,
PARTITION epep201307 VALUES LESS THAN (TO_DAYS('2013-07-01')) ENGINE = InnoDB,
PARTITION epep201308 VALUES LESS THAN (TO_DAYS('2013-08-01')) ENGINE = InnoDB,
PARTITION epep201309 VALUES LESS THAN (TO_DAYS('2013-09-01')) ENGINE = InnoDB,
PARTITION epep201310 VALUES LESS THAN (TO_DAYS('2013-10-01')) ENGINE = InnoDB,
PARTITION epep201311 VALUES LESS THAN (TO_DAYS('2013-11-01')) ENGINE = InnoDB,
PARTITION epep201312 VALUES LESS THAN (TO_DAYS('2013-12-01')) ENGINE = InnoDB,
PARTITION epep201401 VALUES LESS THAN (TO_DAYS('2014-01-01')) ENGINE = InnoDB,
PARTITION epep201402 VALUES LESS THAN (TO_DAYS('2014-02-01')) ENGINE = InnoDB,
PARTITION epep201403 VALUES LESS THAN (TO_DAYS('2014-03-01')) ENGINE = InnoDB,
PARTITION epep201404 VALUES LESS THAN (TO_DAYS('2014-04-01')) ENGINE = InnoDB,
PARTITION epep201405 VALUES LESS THAN (TO_DAYS('2014-05-01')) ENGINE = InnoDB,
PARTITION epep201406 VALUES LESS THAN (TO_DAYS('2014-06-01')) ENGINE = InnoDB,
PARTITION epep201407 VALUES LESS THAN (TO_DAYS('2014-07-01')) ENGINE = InnoDB,
PARTITION epep201408 VALUES LESS THAN (TO_DAYS('2014-08-01')) ENGINE = InnoDB,
PARTITION epep201409 VALUES LESS THAN (TO_DAYS('2014-09-01')) ENGINE = InnoDB,
PARTITION epep201410 VALUES LESS THAN (TO_DAYS('2014-10-01')) ENGINE = InnoDB,
PARTITION epep201411 VALUES LESS THAN (TO_DAYS('2014-11-01')) ENGINE = InnoDB,
PARTITION epep201412 VALUES LESS THAN (TO_DAYS('2014-12-01')) ENGINE = InnoDB,
PARTITION epep201501 VALUES LESS THAN (TO_DAYS('2015-01-01')) ENGINE = InnoDB,
PARTITION epep201502 VALUES LESS THAN (TO_DAYS('2015-02-01')) ENGINE = InnoDB,
PARTITION epep201503 VALUES LESS THAN (TO_DAYS('2015-03-01')) ENGINE = InnoDB,
PARTITION epep201504 VALUES LESS THAN (TO_DAYS('2015-04-01')) ENGINE = InnoDB,
PARTITION epep201505 VALUES LESS THAN (TO_DAYS('2015-05-01')) ENGINE = InnoDB,
PARTITION epep201506 VALUES LESS THAN (TO_DAYS('2015-06-01')) ENGINE = InnoDB,
PARTITION epep201507 VALUES LESS THAN (TO_DAYS('2015-07-01')) ENGINE = InnoDB,
PARTITION epep201508 VALUES LESS THAN (TO_DAYS('2015-08-01')) ENGINE = InnoDB,
PARTITION epep201509 VALUES LESS THAN (TO_DAYS('2015-09-01')) ENGINE = InnoDB,
PARTITION epep201510 VALUES LESS THAN (TO_DAYS('2015-10-01')) ENGINE = InnoDB,
PARTITION epep201511 VALUES LESS THAN (TO_DAYS('2015-11-01')) ENGINE = InnoDB,
PARTITION epep201512 VALUES LESS THAN (TO_DAYS('2015-12-01')) ENGINE = InnoDB,
PARTITION epep201601 VALUES LESS THAN (TO_DAYS('2016-01-01')) ENGINE = InnoDB,
PARTITION epep201602 VALUES LESS THAN (TO_DAYS('2016-02-01')) ENGINE = InnoDB,
PARTITION epep201603 VALUES LESS THAN (TO_DAYS('2016-03-01')) ENGINE = InnoDB,
PARTITION epep201604 VALUES LESS THAN (TO_DAYS('2016-04-01')) ENGINE = InnoDB,
PARTITION epep201605 VALUES LESS THAN (TO_DAYS('2016-05-01')) ENGINE = InnoDB,
PARTITION epep201606 VALUES LESS THAN (TO_DAYS('2016-06-01')) ENGINE = InnoDB,
PARTITION epep201607 VALUES LESS THAN (TO_DAYS('2016-07-01')) ENGINE = InnoDB,
PARTITION epep201608 VALUES LESS THAN (TO_DAYS('2016-08-01')) ENGINE = InnoDB,
PARTITION epep201609 VALUES LESS THAN (TO_DAYS('2016-09-01')) ENGINE = InnoDB,
PARTITION epep201610 VALUES LESS THAN (TO_DAYS('2016-10-01')) ENGINE = InnoDB,
PARTITION epep201611 VALUES LESS THAN (TO_DAYS('2016-11-01')) ENGINE = InnoDB,
PARTITION epep201612 VALUES LESS THAN (TO_DAYS('2016-12-01')) ENGINE = InnoDB,
PARTITION epep201701 VALUES LESS THAN (TO_DAYS('2017-01-01')) ENGINE = InnoDB,
PARTITION epep201702 VALUES LESS THAN (TO_DAYS('2017-02-01')) ENGINE = InnoDB,
PARTITION epep201703 VALUES LESS THAN (TO_DAYS('2017-03-01')) ENGINE = InnoDB,
PARTITION epep201704 VALUES LESS THAN (TO_DAYS('2017-04-01')) ENGINE = InnoDB,
PARTITION epep201705 VALUES LESS THAN (TO_DAYS('2017-05-01')) ENGINE = InnoDB,
PARTITION epep201706 VALUES LESS THAN (TO_DAYS('2017-06-01')) ENGINE = InnoDB,
PARTITION epep201707 VALUES LESS THAN (TO_DAYS('2017-07-01')) ENGINE = InnoDB,
PARTITION epep201708 VALUES LESS THAN (TO_DAYS('2017-08-01')) ENGINE = InnoDB,
PARTITION epep201709 VALUES LESS THAN (TO_DAYS('2017-09-01')) ENGINE = InnoDB,
PARTITION epep201710 VALUES LESS THAN (TO_DAYS('2017-10-01')) ENGINE = InnoDB, 
PARTITION epep201711 VALUES LESS THAN (TO_DAYS('2017-11-01')) ENGINE = InnoDB, 
PARTITION epep201712 VALUES LESS THAN (TO_DAYS('2017-12-01')) ENGINE = InnoDB, 
PARTITION pmax VALUES LESS THAN MAXVALUE ENGINE = InnoDB);

CREATE INDEX idx_ad_links_registered_at ON ad_links(registered_at); 

-- 
--  クリック情報記録テーブル 
-- 
CREATE TABLE IF NOT EXISTS ad_link_clicks ( 
  serial_number BIGINT UNSIGNED AUTO_INCREMENT,
  click_id  VARCHAR(16) NOT NULL UNIQUE, 
  link_id VARHCAR(8)  NOT NULL  COMMENT 'ad_linkテーブルのlink_id',
  uid VARCHAR(16) NOT NULL  COMMENT 'cookieにアクセスユーザごとに発行する識別ID', 
  ad_id VARCHAR(8)  NOT NULL, http_referrer TEXT  NOT NULL, user_agent  VARCHAR(512) NOT NULL,
  remoto_host VARCHAR(255)  NOT NULL,
  remoto_address  VARCHAR(255)  NOT NULL,
  language  VARCHAR(8)  NOT NULL,
  conversion_id VARCHAR(16) NULL,
  registered_at DATETIME NULL
) ENGINE=InnoDB character set utf8 PARTITION BY RANGE (TO_DAYS(registered_at))(
PARTITION epep201301 VALUES LESS THAN (TO_DAYS('2013-01-01')) ENGINE = InnoDB,
PARTITION epep201302 VALUES LESS THAN (TO_DAYS('2013-02-01')) ENGINE = InnoDB,
PARTITION epep201303 VALUES LESS THAN (TO_DAYS('2013-03-01')) ENGINE = InnoDB,
PARTITION epep201304 VALUES LESS THAN (TO_DAYS('2013-04-01')) ENGINE = InnoDB,
PARTITION epep201305 VALUES LESS THAN (TO_DAYS('2013-05-01')) ENGINE = InnoDB,
PARTITION epep201306 VALUES LESS THAN (TO_DAYS('2013-06-01')) ENGINE = InnoDB,
PARTITION epep201307 VALUES LESS THAN (TO_DAYS('2013-07-01')) ENGINE = InnoDB,
PARTITION epep201308 VALUES LESS THAN (TO_DAYS('2013-08-01')) ENGINE = InnoDB,
PARTITION epep201309 VALUES LESS THAN (TO_DAYS('2013-09-01')) ENGINE = InnoDB,
PARTITION epep201310 VALUES LESS THAN (TO_DAYS('2013-10-01')) ENGINE = InnoDB,
PARTITION epep201311 VALUES LESS THAN (TO_DAYS('2013-11-01')) ENGINE = InnoDB,
PARTITION epep201312 VALUES LESS THAN (TO_DAYS('2013-12-01')) ENGINE = InnoDB,
PARTITION epep201401 VALUES LESS THAN (TO_DAYS('2014-01-01')) ENGINE = InnoDB,
PARTITION epep201402 VALUES LESS THAN (TO_DAYS('2014-02-01')) ENGINE = InnoDB,
PARTITION epep201403 VALUES LESS THAN (TO_DAYS('2014-03-01')) ENGINE = InnoDB,
PARTITION epep201404 VALUES LESS THAN (TO_DAYS('2014-04-01')) ENGINE = InnoDB,
PARTITION epep201405 VALUES LESS THAN (TO_DAYS('2014-05-01')) ENGINE = InnoDB,
PARTITION epep201406 VALUES LESS THAN (TO_DAYS('2014-06-01')) ENGINE = InnoDB,
PARTITION epep201407 VALUES LESS THAN (TO_DAYS('2014-07-01')) ENGINE = InnoDB,
PARTITION epep201408 VALUES LESS THAN (TO_DAYS('2014-08-01')) ENGINE = InnoDB,
PARTITION epep201409 VALUES LESS THAN (TO_DAYS('2014-09-01')) ENGINE = InnoDB,
PARTITION epep201410 VALUES LESS THAN (TO_DAYS('2014-10-01')) ENGINE = InnoDB,
PARTITION epep201411 VALUES LESS THAN (TO_DAYS('2014-11-01')) ENGINE = InnoDB,
PARTITION epep201412 VALUES LESS THAN (TO_DAYS('2014-12-01')) ENGINE = InnoDB,
PARTITION epep201501 VALUES LESS THAN (TO_DAYS('2015-01-01')) ENGINE = InnoDB,
PARTITION epep201502 VALUES LESS THAN (TO_DAYS('2015-02-01')) ENGINE = InnoDB,
PARTITION epep201503 VALUES LESS THAN (TO_DAYS('2015-03-01')) ENGINE = InnoDB,
PARTITION epep201504 VALUES LESS THAN (TO_DAYS('2015-04-01')) ENGINE = InnoDB,
PARTITION epep201505 VALUES LESS THAN (TO_DAYS('2015-05-01')) ENGINE = InnoDB,
PARTITION epep201506 VALUES LESS THAN (TO_DAYS('2015-06-01')) ENGINE = InnoDB,
PARTITION epep201507 VALUES LESS THAN (TO_DAYS('2015-07-01')) ENGINE = InnoDB,
PARTITION epep201508 VALUES LESS THAN (TO_DAYS('2015-08-01')) ENGINE = InnoDB,
PARTITION epep201509 VALUES LESS THAN (TO_DAYS('2015-09-01')) ENGINE = InnoDB,
PARTITION epep201510 VALUES LESS THAN (TO_DAYS('2015-10-01')) ENGINE = InnoDB,
PARTITION epep201511 VALUES LESS THAN (TO_DAYS('2015-11-01')) ENGINE = InnoDB,
PARTITION epep201512 VALUES LESS THAN (TO_DAYS('2015-12-01')) ENGINE = InnoDB,
PARTITION epep201601 VALUES LESS THAN (TO_DAYS('2016-01-01')) ENGINE = InnoDB,
PARTITION epep201602 VALUES LESS THAN (TO_DAYS('2016-02-01')) ENGINE = InnoDB,
PARTITION epep201603 VALUES LESS THAN (TO_DAYS('2016-03-01')) ENGINE = InnoDB,
PARTITION epep201604 VALUES LESS THAN (TO_DAYS('2016-04-01')) ENGINE = InnoDB,
PARTITION epep201605 VALUES LESS THAN (TO_DAYS('2016-05-01')) ENGINE = InnoDB,
PARTITION epep201606 VALUES LESS THAN (TO_DAYS('2016-06-01')) ENGINE = InnoDB,
PARTITION epep201607 VALUES LESS THAN (TO_DAYS('2016-07-01')) ENGINE = InnoDB,
PARTITION epep201608 VALUES LESS THAN (TO_DAYS('2016-08-01')) ENGINE = InnoDB,
PARTITION epep201609 VALUES LESS THAN (TO_DAYS('2016-09-01')) ENGINE = InnoDB,
PARTITION epep201610 VALUES LESS THAN (TO_DAYS('2016-10-01')) ENGINE = InnoDB,
PARTITION epep201611 VALUES LESS THAN (TO_DAYS('2016-11-01')) ENGINE = InnoDB,
PARTITION epep201612 VALUES LESS THAN (TO_DAYS('2016-12-01')) ENGINE = InnoDB,
PARTITION epep201701 VALUES LESS THAN (TO_DAYS('2017-01-01')) ENGINE = InnoDB,
PARTITION epep201702 VALUES LESS THAN (TO_DAYS('2017-02-01')) ENGINE = InnoDB,
PARTITION epep201703 VALUES LESS THAN (TO_DAYS('2017-03-01')) ENGINE = InnoDB,
PARTITION epep201704 VALUES LESS THAN (TO_DAYS('2017-04-01')) ENGINE = InnoDB,
PARTITION epep201705 VALUES LESS THAN (TO_DAYS('2017-05-01')) ENGINE = InnoDB,
PARTITION epep201706 VALUES LESS THAN (TO_DAYS('2017-06-01')) ENGINE = InnoDB,
PARTITION epep201707 VALUES LESS THAN (TO_DAYS('2017-07-01')) ENGINE = InnoDB,
PARTITION epep201708 VALUES LESS THAN (TO_DAYS('2017-08-01')) ENGINE = InnoDB,
PARTITION epep201709 VALUES LESS THAN (TO_DAYS('2017-09-01')) ENGINE = InnoDB,
PARTITION epep201710 VALUES LESS THAN (TO_DAYS('2017-10-01')) ENGINE = InnoDB,
PARTITION epep201711 VALUES LESS THAN (TO_DAYS('2017-11-01')) ENGINE = InnoDB,
PARTITION epep201712 VALUES LESS THAN (TO_DAYS('2017-12-01')) ENGINE = InnoDB,
PARTITION pmax VALUES LESS THAN MAXVALUE ENGINE = InnoDB
);

CREATE INDEX idx_ad_link_clicks_registered_at ON ad_link_clicks(registered_at);

--
-- 広告出稿結果テーブル
--
CREATE TABLE IF NOT EXISTS ad_conversions (
  serial_number BIGINT UNSIGNED AUTO_INCREMENT,
  conversion_id VARCHAR(16) NOT NULL UNIQUE,
  click_id  VARCHAR(16) NOT NULL COMMENT 'ad_link_clicksテーブルのclick_id',
  ad_id VARCHAR(8)  NOT NULL,
  claim DOUBLE  NOT NULL,
  affiliator_id VARHCAR(8) NOT NULL,
  reword  DOUBLE  NOT NULL,
  status_flag SMALLINT  NOT NULL COMMENT '0:新規, 100:確定, 255:キャンセル・不成立',
  uid VARCHAR(16) NOT NULL,
  http_referrer TEXT  NOT NULL, user_agent  VARCHAR(512） NOT NULL,
  remoto_host VARCHAR(255)  NOT NULL, 
  remoto_address  VARCHAR(255)  NOT NULL,
  language  VARCHAR(8)  NOT NULL,
  registered_at DATETIME NULL,
	updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB character set utf8 BY RANGE (TO_DAYS(registered_at))(
PARTITION epep201301 VALUES LESS THAN (TO_DAYS('2013-01-01')) ENGINE = InnoDB,
PARTITION epep201302 VALUES LESS THAN (TO_DAYS('2013-02-01')) ENGINE = InnoDB,
PARTITION epep201303 VALUES LESS THAN (TO_DAYS('2013-03-01')) ENGINE = InnoDB,
PARTITION epep201304 VALUES LESS THAN (TO_DAYS('2013-04-01')) ENGINE = InnoDB,
PARTITION epep201305 VALUES LESS THAN (TO_DAYS('2013-05-01')) ENGINE = InnoDB,
PARTITION epep201306 VALUES LESS THAN (TO_DAYS('2013-06-01')) ENGINE = InnoDB,
PARTITION epep201307 VALUES LESS THAN (TO_DAYS('2013-07-01')) ENGINE = InnoDB,
PARTITION epep201308 VALUES LESS THAN (TO_DAYS('2013-08-01')) ENGINE = InnoDB,
PARTITION epep201309 VALUES LESS THAN (TO_DAYS('2013-09-01')) ENGINE = InnoDB,
PARTITION epep201310 VALUES LESS THAN (TO_DAYS('2013-10-01')) ENGINE = InnoDB,
PARTITION epep201311 VALUES LESS THAN (TO_DAYS('2013-11-01')) ENGINE = InnoDB,
PARTITION epep201312 VALUES LESS THAN (TO_DAYS('2013-12-01')) ENGINE = InnoDB,
PARTITION epep201401 VALUES LESS THAN (TO_DAYS('2014-01-01')) ENGINE = InnoDB,
PARTITION epep201402 VALUES LESS THAN (TO_DAYS('2014-02-01')) ENGINE = InnoDB,
PARTITION epep201403 VALUES LESS THAN (TO_DAYS('2014-03-01')) ENGINE = InnoDB,
PARTITION epep201404 VALUES LESS THAN (TO_DAYS('2014-04-01')) ENGINE = InnoDB,
PARTITION epep201405 VALUES LESS THAN (TO_DAYS('2014-05-01')) ENGINE = InnoDB,
PARTITION epep201406 VALUES LESS THAN (TO_DAYS('2014-06-01')) ENGINE = InnoDB,
PARTITION epep201407 VALUES LESS THAN (TO_DAYS('2014-07-01')) ENGINE = InnoDB,
PARTITION epep201408 VALUES LESS THAN (TO_DAYS('2014-08-01')) ENGINE = InnoDB,
PARTITION epep201409 VALUES LESS THAN (TO_DAYS('2014-09-01')) ENGINE = InnoDB,
PARTITION epep201410 VALUES LESS THAN (TO_DAYS('2014-10-01')) ENGINE = InnoDB,
PARTITION epep201411 VALUES LESS THAN (TO_DAYS('2014-11-01')) ENGINE = InnoDB,
PARTITION epep201412 VALUES LESS THAN (TO_DAYS('2014-12-01')) ENGINE = InnoDB,
PARTITION epep201501 VALUES LESS THAN (TO_DAYS('2015-01-01')) ENGINE = InnoDB,
PARTITION epep201502 VALUES LESS THAN (TO_DAYS('2015-02-01')) ENGINE = InnoDB,
PARTITION epep201503 VALUES LESS THAN (TO_DAYS('2015-03-01')) ENGINE = InnoDB,
PARTITION epep201504 VALUES LESS THAN (TO_DAYS('2015-04-01')) ENGINE = InnoDB,
PARTITION epep201505 VALUES LESS THAN (TO_DAYS('2015-05-01')) ENGINE = InnoDB,
PARTITION epep201506 VALUES LESS THAN (TO_DAYS('2015-06-01')) ENGINE = InnoDB,
PARTITION epep201507 VALUES LESS THAN (TO_DAYS('2015-07-01')) ENGINE = InnoDB,
PARTITION epep201508 VALUES LESS THAN (TO_DAYS('2015-08-01')) ENGINE = InnoDB,
PARTITION epep201509 VALUES LESS THAN (TO_DAYS('2015-09-01')) ENGINE = InnoDB,
PARTITION epep201510 VALUES LESS THAN (TO_DAYS('2015-10-01')) ENGINE = InnoDB,
PARTITION epep201511 VALUES LESS THAN (TO_DAYS('2015-11-01')) ENGINE = InnoDB,
PARTITION epep201512 VALUES LESS THAN (TO_DAYS('2015-12-01')) ENGINE = InnoDB,
PARTITION epep201601 VALUES LESS THAN (TO_DAYS('2016-01-01')) ENGINE = InnoDB,
PARTITION epep201602 VALUES LESS THAN (TO_DAYS('2016-02-01')) ENGINE = InnoDB,
PARTITION epep201603 VALUES LESS THAN (TO_DAYS('2016-03-01')) ENGINE = InnoDB,
PARTITION epep201604 VALUES LESS THAN (TO_DAYS('2016-04-01')) ENGINE = InnoDB,
PARTITION epep201605 VALUES LESS THAN (TO_DAYS('2016-05-01')) ENGINE = InnoDB,
PARTITION epep201606 VALUES LESS THAN (TO_DAYS('2016-06-01')) ENGINE = InnoDB,
PARTITION epep201607 VALUES LESS THAN (TO_DAYS('2016-07-01')) ENGINE = InnoDB,
PARTITION epep201608 VALUES LESS THAN (TO_DAYS('2016-08-01')) ENGINE = InnoDB,
PARTITION epep201609 VALUES LESS THAN (TO_DAYS('2016-09-01')) ENGINE = InnoDB,
PARTITION epep201610 VALUES LESS THAN (TO_DAYS('2016-10-01')) ENGINE = InnoDB,
PARTITION epep201611 VALUES LESS THAN (TO_DAYS('2016-11-01')) ENGINE = InnoDB,
PARTITION epep201612 VALUES LESS THAN (TO_DAYS('2016-12-01')) ENGINE = InnoDB,
PARTITION epep201701 VALUES LESS THAN (TO_DAYS('2017-01-01')) ENGINE = InnoDB,
PARTITION epep201702 VALUES LESS THAN (TO_DAYS('2017-02-01')) ENGINE = InnoDB,
PARTITION epep201703 VALUES LESS THAN (TO_DAYS('2017-03-01')) ENGINE = InnoDB,
PARTITION epep201704 VALUES LESS THAN (TO_DAYS('2017-04-01')) ENGINE = InnoDB,
PARTITION epep201705 VALUES LESS THAN (TO_DAYS('2017-05-01')) ENGINE = InnoDB,
PARTITION epep201706 VALUES LESS THAN (TO_DAYS('2017-06-01')) ENGINE = InnoDB,
PARTITION epep201707 VALUES LESS THAN (TO_DAYS('2017-07-01')) ENGINE = InnoDB,
PARTITION epep201708 VALUES LESS THAN (TO_DAYS('2017-08-01')) ENGINE = InnoDB,
PARTITION epep201709 VALUES LESS THAN (TO_DAYS('2017-09-01')) ENGINE = InnoDB,
PARTITION epep201710 VALUES LESS THAN (TO_DAYS('2017-10-01')) ENGINE = InnoDB,
PARTITION epep201711 VALUES LESS THAN (TO_DAYS('2017-11-01')) ENGINE = InnoDB,
PARTITION epep201712 VALUES LESS THAN (TO_DAYS('2017-12-01')) ENGINE = InnoDB,
PARTITION pmax VALUES LESS THAN MAXVALUE ENGINE = InnoDB
);

CREATE INDEX idx_ad_conversions_registered_at ON ad_conversions(registered_at);
